<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Social Scene</title>
	<link rel="stylesheet" href="./stylesheets/app.css">
</head>
<body>
  <%const base = 'https://image.tmdb.org/t/p/w185';%>
  <header key="splash_screen">
    <div class="App-header" onclick="window.location.href='/user'" style="cursor:pointer;">
      SocialScene
    </div>
  </header>

  <!-- nav bar stuff -->
  <ul>
    <li><a class="current" href="/user" >Home</a></li>
    <li><a href="/edituser">Edit User</a></li>
    <li class="drop">
      <a href="/fmanage">Friends List</a>
      <div class="droplist">
        <a href="/fsearch" style="border: 0px">Manage Friends</a>
      </div>
    </li>
    <li style="float: right"><a href="/logout">Logout</a></li>
    <li style="float: right"><a href="/tmdb">Search</a></li>
  </ul> 

  <p align="left" style="color: white; font-size: 30px;margin:10px">
    <strong> Welcome <%= fname %> <%= lname %>, </strong>
  </p>
  
<!-- old seach bar
  <div style="display: inline-block;float: right;">
    <form method= 'post' style="padding: 10px;">
      <input type="text" name="keyword" placeholder =" Enter Keyword to search" style="width: 300px" required>
      <input type="hidden" name="pg" value="1">
      <table>
        <td><button style="width: 150px; height: 35px; font-size : 18px;" formaction="/searchmv">Search Movies</button></td>
        <td><button style="width: 150px; height: 35px; font-size : 18px;" formaction="/searchtv">Search TV</button></td>
      </table>
    </form>
  </div>
 -->


  <br/>
  <% var n = rows.length;%>
  <%if (n !=0){%>
    <!-- review table -->
    <div>
      <table class="display" style="border-collapse: collapse;">
        <!-- column names -->
        <th style="padding-left: 10px;padding-right: 10px;border: 2px solid black"> ID </th>
        <th style="padding-left: 10px;padding-right: 10px;border: 2px solid black"> Category </th>
        <th style="padding-left: 10px;padding-right: 10px;border: 2px solid black"> Movie&nbsp;Name </th>
        <th style="padding-left: 10px;padding-right: 10px; border: 2px solid black"> Rating </th>
        <th style="padding-left: 10px;padding-right: 10px; border: 2px solid black"> Review </th>
        <!-- displaying the data -->
        <% for (var i=0; i<n ; i++) { %>
        <% r = rows[i]; %>
        <tr class="rev_display" style="padding-left: 10px;padding-right: 10px;border: 2px solid black">
            <td style="padding-left: 10px;padding-right: 10px"><%= r.id %></td>
            <td style="padding-left: 10px;padding-right: 10px;border: 2px solid black"><%= r.category %></td>
            <td class="title" style="cursor:pointer; padding-left: 10px;padding-right: 10px;border: 2px solid black" onclick="document.getElementById(<%=i%>).submit()"><%= r.title %></td>
            <td style="padding-left: 10px;padding-right: 10px;border: 2px solid black"><%= r.rating %></td>
            <td style="padding-left: 10px;padding-right: 10px;border: 2px solid black"><%= r.review %></td>

            <!-- data to render detailed page on a movie reviewed -->
            <form id='<%=i%>' method="post" action="/details_rev">
              <input type="hidden" name="category" value="<%=r.category%>">
              <input type="hidden" name="id" value="<%=r.id%>">
            </form>
        </tr>
          <% }; %>
      </table>
  	</div>
  <%};%>

  <!-- popular movie -->
  <h3 style="color: white;">Popular Movies</h3>
  <div class="popular">
    <%var m =popularmv.length%>
    <% for (var i=0; i<m ; i++) { %>
      <div class="collection" onmouseout='this.style.opacity=1' onmouseover='this.style.opacity=0.5' onclick='document.getElementById(<%=popularmv[i].id%>).submit()'>
        <% r = popularmv[i]; %>
        <%= r.title %><br>
        <%if(r.poster_path == null){%>
          <img src = '/noimg.jpg'>
        <%}else{%>
          <%var url = base + r.poster_path%>
          <img src= '<%=url%>'>
        <%};%>
      </div>
      <!-- onclick submit this form to render mv summary -->
      <form style="display:none" id='<%=r.id%>' method="post" action="/details_rev">
        <input type="hidden" name="category" value="mv">
        <input type="hidden" name="id" value="<%=r.id%>">
      </form>
    <%};%>
  </div>

  <!-- popular tv shows -->
  <h3 style="color: white;">Popular TV Shows</h3>
  <div class='popular'>
    <%var m =populartv.length%>
    <% for (var i=0; i<m ; i++) { %>
      <div class="collection" onmouseout='this.style.opacity=1' onmouseover='this.style.opacity=0.5' onclick='document.getElementById("<%=populartv[i].id%>").submit()'>
        <% r = populartv[i]; %>
        <%= r.name %><br>
        <%if(r.poster_path == null){%>
          <img src = '/noimg.jpg'>
        <%}else{%>
          <%var url = base + r.poster_path%>
          <img src= '<%=url%>'>
        <%};%>
      </div>
      <!-- onclick submit this form to render tv summary -->
      <form style="display:none" id='<%=r.id%>' method="post" action="/details_rev">
        <input type="hidden" name="category" value="tv">
        <input type="hidden" name="id" value="<%=r.id%>">
      </form>
    <%};%>
  </div>
  
  <!-- Chatbox -->
  <button class="collapsible" style="position:fixed; right:100px; bottom:0px">Chat</button>
    <div class="content">
      <iframe src="/chat" height="400" width="300" frameBorder="0"></iframe>
  </div>

  <script>
  var coll = document.getElementsByClassName("collapsible");
  var i;

  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.maxHeight){
        content.style.maxHeight = null;
      } else {
        content.style.maxHeight = content.scrollHeight + "px";
      } 
    });
  }
  </script>

</body>
</html>